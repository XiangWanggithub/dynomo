# âœ… ä»£ç é‡æ„å®Œæˆ

## ğŸ¯ é‡æ„ç›®æ ‡

å·²æˆåŠŸä¸º DynOMo é¡¹ç›®æ·»åŠ äº†è‡ªå®šä¹‰æ•°æ®é›†çš„åœ¨çº¿è¿½è¸ªåŠŸèƒ½ï¼ŒåŒ…å«å®Œæ•´çš„**è®­ç»ƒ/å¾®è°ƒ**å’Œ**æ¨ç†**ä¸¤ä¸ªç‹¬ç«‹å…¥å£ã€‚

## ğŸ“¦ æ–°å¢æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒä»£ç 
1. **`src/datasets/datasets/custom_dataset.py`** - è‡ªå®šä¹‰æ•°æ®é›†ç±»
2. **`scripts/train_custom.py`** - è®­ç»ƒ/å¾®è°ƒè„šæœ¬ï¼ˆå…¥å£1ï¼‰
3. **`scripts/inference_custom.py`** - æ¨ç†è„šæœ¬ï¼ˆå…¥å£2ï¼‰

### é…ç½®æ–‡ä»¶
4. **`configs/custom/dynomo_custom.py`** - ä¸»é…ç½®æ–‡ä»¶
5. **`configs/data/custom.yaml`** - ç›¸æœºå‚æ•°é…ç½®

### å·¥å…·å’Œæ–‡æ¡£
6. **`examples/prepare_custom_data.py`** - æ•°æ®éªŒè¯å·¥å…·
7. **`test_custom_setup.py`** - å®‰è£…éªŒè¯è„šæœ¬
8. **`CUSTOM_DATASET_README.md`** - å®Œæ•´ä½¿ç”¨æ–‡æ¡£
9. **`QUICKSTART_CUSTOM.md`** - å¿«é€Ÿå¼€å§‹æŒ‡å—
10. **`REFACTOR_SUMMARY.md`** - é‡æ„æ€»ç»“
11. **`é‡æ„å®Œæˆè¯´æ˜.md`** - æœ¬æ–‡æ¡£

### ä¿®æ”¹çš„æ–‡ä»¶
- **`src/datasets/datasets/__init__.py`** - æ·»åŠ CustomDatasetå¯¼å…¥
- **`src/utils/get_data.py`** - æ·»åŠ è‡ªå®šä¹‰æ•°æ®é›†æ”¯æŒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æ•°æ®

ä½ çš„æ•°æ®åº”è¯¥ç»„ç»‡æˆå¦‚ä¸‹ç»“æ„ï¼š

```
data/custom/
â””â”€â”€ your_sequence_name/
    â”œâ”€â”€ rgb/          # RGBå›¾åƒï¼ˆå¿…éœ€ï¼‰
    â”‚   â”œâ”€â”€ 000000.png
    â”‚   â”œâ”€â”€ 000001.png
    â”‚   â””â”€â”€ ...
    â”œâ”€â”€ depth/        # æ·±åº¦å›¾ï¼ˆå¯é€‰ï¼Œå¯ç”¨åœ¨çº¿ä¼°è®¡ä»£æ›¿ï¼‰
    â”‚   â”œâ”€â”€ 000000.npy
    â”‚   â””â”€â”€ ...
    â””â”€â”€ sam/          # SAMåˆ†å‰²æ©ç ï¼ˆå¿…éœ€ï¼‰
        â”œâ”€â”€ 000000.png
        â””â”€â”€ ...
```

### ç¬¬äºŒæ­¥ï¼šéªŒè¯æ•°æ®

```bash
python examples/prepare_custom_data.py \
    --basedir data/custom \
    --sequence your_sequence_name
```

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®å‚æ•°

ç¼–è¾‘ `configs/data/custom.yaml`ï¼Œè®¾ç½®ä½ çš„ç›¸æœºå‚æ•°ï¼š
```yaml
camera_params:
  image_height: 480
  image_width: 640
  fx: 525.0
  fy: 525.0
  cx: 320.0
  cy: 240.0
```

ç¼–è¾‘ `configs/custom/dynomo_custom.py`ï¼Œè®¾ç½®åºåˆ—åç§°å’Œæ•°æ®è·¯å¾„ï¼š
```python
scene_name = "your_sequence_name"
config = dict(
    data=dict(
        basedir="data/custom",
        sequence=scene_name,
    ),
)
```

### ç¬¬å››æ­¥ï¼šè®­ç»ƒï¼ˆå…¥å£1 - å‚æ•°å¾®è°ƒï¼‰

```bash
# åŸºç¡€è®­ç»ƒï¼ˆå¦‚æœæœ‰é¢„è®¡ç®—çš„depthï¼‰
python scripts/train_custom.py \
    --config configs/custom/dynomo_custom.py \
    --sequence your_sequence_name \
    --gpus 0

# æˆ–è€…ä½¿ç”¨åœ¨çº¿æ·±åº¦ä¼°è®¡å’Œç‰¹å¾æå–
python scripts/train_custom.py \
    --config configs/custom/dynomo_custom.py \
    --sequence your_sequence_name \
    --gpus 0 \
    --online_depth DepthAnythingV2-vitl \
    --online_emb dinov2_vits14
```

### ç¬¬äº”æ­¥ï¼šæ¨ç†ï¼ˆå…¥å£2 - æ¨ç†ï¼‰

```bash
python scripts/inference_custom.py \
    --results_dir experiments/custom/200_200_200/your_sequence_name \
    --gpu 0 \
    --vis_trajs \
    --vis_grid
```

## ğŸ“‹ å…³é”®ç‰¹æ€§

### âœ… æ”¯æŒçš„æ•°æ®æ ¼å¼

| ç±»å‹ | æ”¯æŒæ ¼å¼ | æ˜¯å¦å¿…éœ€ | å¤‡æ³¨ |
|------|---------|---------|------|
| RGB | .jpg, .png, .jpeg | âœ… å¿…éœ€ | |
| Depth | .npy, .png, .exr | âŒ å¯é€‰ | å¯ç”¨åœ¨çº¿ä¼°è®¡ä»£æ›¿ |
| SAMåˆ†å‰² | .png, .jpg | âœ… å¿…éœ€ | èƒŒæ™¯ä¸ºé»‘è‰² |
| ç‰¹å¾ | .npy | âŒ å¯é€‰ | å¯ç”¨åœ¨çº¿æå–ä»£æ›¿ |
| ä½å§¿ | .npy, .txt | âŒ å¯é€‰ | é»˜è®¤ä½¿ç”¨å•ä½çŸ©é˜µ |

### âœ… åœ¨çº¿å¤„ç†åŠŸèƒ½

- **åœ¨çº¿æ·±åº¦ä¼°è®¡**: `--online_depth DepthAnythingV2-vitl`
- **åœ¨çº¿ç‰¹å¾æå–**: `--online_emb dinov2_vits14`

### âœ… ä¸¤ä¸ªç‹¬ç«‹å…¥å£

#### å…¥å£1: è®­ç»ƒ/å¾®è°ƒ (`train_custom.py`)
- ä»å¤´å¼€å§‹è®­ç»ƒ
- ä»checkpointæ¢å¤è®­ç»ƒ
- è‡ªåŠ¨ä¿å­˜é…ç½®å’Œå‚æ•°
- æ”¯æŒåœ¨çº¿æ·±åº¦å’Œç‰¹å¾

#### å…¥å£2: æ¨ç† (`inference_custom.py`)
- åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹
- è½¨è¿¹é¢„æµ‹å’Œå¯è§†åŒ–
- æ¸²æŸ“è´¨é‡è¯„ä¼°
- æ–°è§†è§’åˆæˆ

## ğŸ“– å®Œæ•´æ–‡æ¡£

1. **å¿«é€Ÿå¼€å§‹**: æŸ¥çœ‹ `QUICKSTART_CUSTOM.md`
2. **è¯¦ç»†æ–‡æ¡£**: æŸ¥çœ‹ `CUSTOM_DATASET_README.md`
3. **é‡æ„æ€»ç»“**: æŸ¥çœ‹ `REFACTOR_SUMMARY.md`

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### éªŒè¯æ•°æ®é›†
```bash
python examples/prepare_custom_data.py --basedir data/custom --sequence your_seq
```

### è®­ç»ƒï¼ˆå®Œæ•´å‚æ•°ï¼‰
```bash
python scripts/train_custom.py \
    --config configs/custom/dynomo_custom.py \
    --sequence your_sequence \
    --gpus 0 \
    --online_depth DepthAnythingV2-vitl \
    --online_emb dinov2_vits14 \
    --checkpoint path/to/checkpoint.npz  # å¯é€‰ï¼šæ¢å¤è®­ç»ƒ
```

### æ¨ç†ï¼ˆå®Œæ•´å‚æ•°ï¼‰
```bash
python scripts/inference_custom.py \
    --results_dir experiments/custom/200_200_200/your_sequence \
    --gpu 0 \
    --vis_trajs \
    --vis_grid \
    --novel_view_mode circle \
    --vis_all
```

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### å¦‚æœæ²¡æœ‰æ·±åº¦å›¾
ä½¿ç”¨åœ¨çº¿æ·±åº¦ä¼°è®¡ï¼š
```bash
--online_depth DepthAnythingV2-vitl
```

### å¦‚æœæ²¡æœ‰é¢„è®¡ç®—ç‰¹å¾
ä½¿ç”¨åœ¨çº¿ç‰¹å¾æå–ï¼š
```bash
--online_emb dinov2_vits14
```

### å¦‚æœå†…å­˜ä¸è¶³
åœ¨é…ç½®æ–‡ä»¶ä¸­é™ä½åˆ†è¾¨ç‡ï¼š
```python
desired_image_height = 0.25,  # 1/4åˆ†è¾¨ç‡
desired_image_width = 0.25,
```

### å¦‚æœæƒ³åŠ é€Ÿè®­ç»ƒ
è°ƒæ•´è¿­ä»£æ¬¡æ•°ï¼š
```python
tracking_iters = 100,
tracking_iters_init = 100,
tracking_iters_cam = 100,
```

## ğŸ¨ è¾“å‡ºç»“æœ

### è®­ç»ƒè¾“å‡º
```
experiments/custom/200_200_200/your_sequence/
â”œâ”€â”€ config.json          # ä½¿ç”¨çš„é…ç½®
â”œâ”€â”€ params.npz          # è®­ç»ƒçš„å‚æ•°
â”œâ”€â”€ checkpoint_*.npz    # è®­ç»ƒcheckpoint
â””â”€â”€ logs/               # è®­ç»ƒæ—¥å¿—
```

### æ¨ç†è¾“å‡º
```
experiments/custom/200_200_200/your_sequence/eval/
â”œâ”€â”€ renderings/         # æ¸²æŸ“å›¾åƒ
â”œâ”€â”€ trajectories/       # é¢„æµ‹è½¨è¿¹
â”œâ”€â”€ visualizations/     # å¯è§†åŒ–ç»“æœ
â””â”€â”€ metrics.json        # è¯„ä¼°æŒ‡æ ‡
```

## âš™ï¸ ä¸»è¦é…ç½®å‚æ•°

### æ•°æ®é…ç½®
```python
data=dict(
    basedir="data/custom",              # æ•°æ®ç›®å½•
    sequence="your_sequence",           # åºåˆ—åç§°
    desired_image_height=0.5,           # å›¾åƒé«˜åº¦ç¼©æ”¾
    desired_image_width=0.5,            # å›¾åƒå®½åº¦ç¼©æ”¾
    online_depth=None,                  # åœ¨çº¿æ·±åº¦ä¼°è®¡
    online_emb='dinov2_vits14',        # åœ¨çº¿ç‰¹å¾æå–
    use_gt_poses=False,                 # æ˜¯å¦ä½¿ç”¨çœŸå€¼ä½å§¿
)
```

### è®­ç»ƒé…ç½®
```python
tracking_obj=dict(
    num_iters=200,                      # è¿­ä»£æ¬¡æ•°
    loss_weights=dict(
        im=1.0,                         # RGBæŸå¤±æƒé‡
        depth=0.1,                      # æ·±åº¦æŸå¤±æƒé‡
        embeddings=16.0,                # ç‰¹å¾æŸå¤±æƒé‡
    ),
    lrs=dict(
        means3D=0.016,                  # 3Dä½ç½®å­¦ä¹ ç‡
        rgb_colors=0.0025,              # é¢œè‰²å­¦ä¹ ç‡
    ),
)
```

## ğŸ› é—®é¢˜æ’æŸ¥

### å¸¸è§é”™è¯¯

1. **æ‰¾ä¸åˆ°RGBç›®å½•**
   - æ£€æŸ¥ `basedir` å’Œ `sequence` é…ç½®æ˜¯å¦æ­£ç¡®
   - ç¡®ä¿ç›®å½•ç»“æ„ç¬¦åˆè¦æ±‚

2. **æ–‡ä»¶æ•°é‡ä¸åŒ¹é…**
   - ç¡®ä¿RGBã€depthã€SAMçš„æ–‡ä»¶æ•°é‡ç›¸åŒ
   - ä½¿ç”¨ `prepare_custom_data.py` éªŒè¯

3. **å†…å­˜ä¸è¶³**
   - é™ä½å›¾åƒåˆ†è¾¨ç‡
   - å‡å°‘è¿­ä»£æ¬¡æ•°
   - å¤„ç†éƒ¨åˆ†å¸§ï¼ˆè®¾ç½® `every_x_frame`ï¼‰

4. **è¿½è¸ªè´¨é‡å·®**
   - è°ƒæ•´æŸå¤±æƒé‡
   - å¢åŠ è¿­ä»£æ¬¡æ•°
   - æ£€æŸ¥depthå’ŒSAMè´¨é‡

## ğŸ“ è·å–å¸®åŠ©

1. æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£: `CUSTOM_DATASET_README.md`
2. æŸ¥çœ‹å¿«é€ŸæŒ‡å—: `QUICKSTART_CUSTOM.md`
3. è¿è¡Œæ•°æ®éªŒè¯: `python examples/prepare_custom_data.py`
4. æŸ¥çœ‹é‡æ„æ€»ç»“: `REFACTOR_SUMMARY.md`

## âœ¨ ç¤ºä¾‹å·¥ä½œæµ

```bash
# 1. éªŒè¯æ•°æ®
python examples/prepare_custom_data.py \
    --basedir data/custom \
    --sequence my_sequence

# 2. è®­ç»ƒæ¨¡å‹
python scripts/train_custom.py \
    --config configs/custom/dynomo_custom.py \
    --sequence my_sequence \
    --gpus 0 \
    --online_depth DepthAnythingV2-vitl \
    --online_emb dinov2_vits14

# 3. è¿è¡Œæ¨ç†
python scripts/inference_custom.py \
    --results_dir experiments/custom/200_200_200/my_sequence \
    --gpu 0 \
    --vis_trajs \
    --vis_grid

# 4. æŸ¥çœ‹ç»“æœ
# ç»“æœä¿å­˜åœ¨: experiments/custom/200_200_200/my_sequence/eval/
```

## ğŸ‰ å®Œæˆï¼

é‡æ„å·²å®Œæˆï¼Œä½ ç°åœ¨å¯ä»¥ï¼š

1. âœ… ä½¿ç”¨è‡ªå·±çš„RGB + Depth + SAMæ•°æ®
2. âœ… é€šè¿‡ `train_custom.py` è¿›è¡Œå‚æ•°å¾®è°ƒ
3. âœ… é€šè¿‡ `inference_custom.py` è¿›è¡Œæ¨ç†
4. âœ… çµæ´»é€‰æ‹©åœ¨çº¿æˆ–ç¦»çº¿æ·±åº¦/ç‰¹å¾
5. âœ… å®Œæ•´çš„é…ç½®å’Œæ–‡æ¡£æ”¯æŒ

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸš€
